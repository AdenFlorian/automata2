<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>Babylon - Getting Started</title>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="canvas" height="1440" width="2560" style="width: 2560px; height: 1440px; image-rendering: pixelated;"></canvas>
    <script type="x-shader/x-fragment" id="fragment-shader-display">
      precision mediump float;
      uniform sampler2D state;
      void main(void) {
        vec2 coord = vec2(gl_FragCoord)/64.0;
        gl_FragColor = texture2D(state, coord);
      }
    </script>
    <script type="x-shader/x-fragment" id="fragment-shader-stepper">
      precision mediump float;
      uniform sampler2D previousState;
      int wasAlive(vec2 coord) {
        if (coord.x < 0.0 || 64.0 < coord.x || coord.y < 0.0 || 64.0 < coord.y) return 0;
        vec4 px = texture2D(previousState, coord/64.0);
        return px.r < 0.1 ? 1 : 0;
      }
      void main(void) {
        vec2 coord = vec2(gl_FragCoord);
        int aliveNeighbors =
          wasAlive(coord+vec2(-1.,-1.)) +
          wasAlive(coord+vec2(-1.,0.)) +
          wasAlive(coord+vec2(-1.,1.)) +
          wasAlive(coord+vec2(0.,-1.)) +
          wasAlive(coord+vec2(0.,1.)) +
          wasAlive(coord+vec2(1.,-1.)) +
          wasAlive(coord+vec2(1.,0.)) +
          wasAlive(coord+vec2(1.,1.));
        bool nowAlive = wasAlive(coord) == 1 ? 2 <= aliveNeighbors && aliveNeighbors <= 3 : 3 == aliveNeighbors;
        gl_FragColor = nowAlive ? vec4(0.,0.,0.,1.) : vec4(1.,1.,1.,1.);
      }
    </script>
    <script src="./fisher.ts"></script>
</body>

</html>
